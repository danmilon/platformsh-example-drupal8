language: php

# This can be set to whatever you want since Lando is taking care of your deps
php:
  - 7.1

services:
  - docker

before_install:

  # Install Lando
  - sudo apt-get -y update
  - sudo apt-get -y install cgroup-bin curl
  - curl -fsSL -o /tmp/lando-latest.deb http://installer.kalabox.io/lando-latest-dev.deb
  - sudo dpkg -i /tmp/lando-latest.deb

  # Sanity check to make sure we are rolling
  - lando version

script:

  # Start the site
  - lando start -- -v

  # Run non-db required tests eg linting/code standards/unit tests
  # cd web
  # lando
  # lando
  # lando phpunit -c core --testsuite unit --exclude-group Composer

  # Get stuff from platform
  cd ..
  lando platform auth:info
  lando platform db:dump --gzip --file=dump.sql.gz --project=$PLATFORMSH_PROJECT_ID --environment=master
  lando db-import dump.sql.gz
  rm -f dump.sql.gz
  cd web
  lando status && lando drush cr

  # Run db required tests
  # - lando behat
